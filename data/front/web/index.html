<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Web denoiser demo</title>
</head>

<body>
  <h1>Web denoiser</h1>


  <form class="box" method="post" action="" enctype="multipart/form-data">
    <div class="box__input">
      <input class="box__file" type="file" name="files[]" id="file" data-multiple-caption="{count} files selected" multiple />
      <label for="file">
        <strong>Choose a file</strong>
        <span class="box__dragndrop"> or drag it here</span>.</label>
      <button class="box__button" type="submit">Upload</button>
    </div>
    <div class="box__uploading">Uploading&hellip;</div>
    <div class="box__success">Done!</div>
    <div class="box__error">Error!
      <span></span>.</div>
  </form>

  <ul id="messages"></ul>
  <form action="" id="form-message">
    <input id="m" autocomplete="off" />
    <button>Send</button>
  </form>


  <div id="app">
    <waveform ref="source"></waveform>
    <waveform ref="result"></waveform>
  </div>


  <audio controls=controls>
    <source src="/public/speech1.wav">
  </audio>

  <canvas id="canvas" width="450" height="275">
    Canvas not supported
  </canvas>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/peaks.js/0.9.8/peaks.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.13/vue.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="/vendor/waveform-data.js"></script>
  <script type="module" src="/component.js"></script>
  <script type="module" src="/app.js"></script>
  <script>
    var socket;
    socket = io();

    socket.on("connect", function () {
      console.log("connect")
    })

    $(function () {
      console.log(socket.io.engine.id)

      $('#form-message').submit(function () {
        socket.emit('chat message', $('#m').val());
        $('#m').val('');
        return false;
      });

      socket.on('chat message', function (msg) {
        console.log("on chat message");
        $('#messages').append($('<li> PUBLIC').text(msg));
      });

      socket.on('message', function (message) {
        console.log("message:" + message);
      });

      window.app.$refs.source.setWaveformSource("/public/speech1.wav.dat")
    });



    // var waveform;
    // var waveformResponse;
    // const xhr = new XMLHttpRequest();
    // // .dat file generated by audiowaveform program 
    // xhr.responseType = "arraybuffer";
    // xhr.open("GET", "/public/speech1.wav.dat");

    // xhr.addEventListener("load", progressEvent => {
    //   waveformResponse = progressEvent.target;
    //   waveform = WaveformData.create(waveformResponse.response);

    //   console.log("waveform loaded:" + waveform.duration);

    //   drawWaveform();
    // });

    // xhr.send();

    // const interpolateHeight = (total_height) => {
    //   const amplitude = 256;
    //   return (size) => total_height - ((size + 128) * total_height) / amplitude;
    // };

    // function drawWaveform() {
    //   var canvas = document.getElementById('canvas'),
    //     context = canvas.getContext('2d'),
    //     repeatRadio = document.getElementById('repeatRadio'),
    //     noRepeatRadio = document.getElementById('noRepeatRadio'),
    //     repeatXRadio = document.getElementById('repeatXRadio'),
    //     repeatYRadio = document.getElementById('repeatYRadio'),
    //     image = new Image();

    //   console.log(canvas)

    //   var canvas = document.getElementById('canvas');

    //   const y = interpolateHeight(canvas.height);
    //   const ctx = canvas.getContext("2d");
    //   ctx.beginPath();

    //   // from 0 to 100
    //   waveform.min.forEach((val, x) => ctx.lineTo(x + 0.5, y(val) + 0.5));

    //   // then looping back from 100 to 0
    //   waveform.max.reverse().forEach((val, x) => {
    //     ctx.lineTo((waveform.offset_length - x) + 0.5, y(val) + 0.5);
    //   });

    //   ctx.closePath();
    //   ctx.stroke();
    // }



  </script>
</body>

</html>